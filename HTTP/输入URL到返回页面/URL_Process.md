# 浏览器中输入URL到返回页面的全过程

## 第一步：解析域名，找到主机IP
1. 浏览器会缓存DNS一段时间，如果有缓存，直接返回IP，否则进行下一步。
2. 如果在缓存中无法找到IP，浏览器会进行一个系统调用，查询hosts文件，如果找到则直接返回IP，否则进行下一步。（hosts文件中保存有域名与IP的对应解析）
3. 借助网络，通过路由器或ISP服务商查询DNS缓存，如果仍查不到IP，进行下一步。
4. 查不到路由器和ISP服务商的DNS缓存的话，ISP的DNS服务器就会开始从根域名服务器开始递归搜索，从.com顶级域名服务器，到baidu的域名服务器等等。

## 第二步：浏览器与网站建立TCP连接
浏览器利用IP直接与网站主机通信。浏览器发出TCP（SYN标志位为1）连接请求，主机返回TCP（SYN，ACK标志位均为1）应答报文，浏览器收到应答报文发现ACK标志位为1，表示连接请求确认。浏览器返回TCP确认报文，主机收到确认报文，三次握手结束，TCP连接建立完成。

## 第三步：浏览器发起GET请求
浏览器向主机发起一个HTTP-GEP方法报文请求，请求中包含访问的URL，还有User-Agent用户浏览器操作系统信息、编码等。值得一提的是Accept-Encoding和Cookies项。Accept-Encoding一般采用gzip，压缩之后传输html文件。Cookies如果是首次访问，会提示服务器建立用户缓存信息，如果不是，可以利用Cookies对应键值，找到相应缓存，缓存里面存放着用户名，密码和一些用户设置项。

## 第四步：显示页面或者返回其他信息
返回状态码为200 OK，表示服务器可以相应请求，返回报文，由于在报头中Content-type为"text/html"，浏览器以HTML形式呈现，而不是下载文件。
但是，对于大型网站存在多个主机站点，往往不会直接返回请求页面，而是重定向，返回的状态码就不是200 OK，而是301,302这种以3开头的重定向码，浏览器在获取了重定向响应后，在响应报文中Location项找到重定向地址，浏览器重新第一步访问即可。